<div class="leftmenu-wrapper z-50">
  <%= link_to root_path, class: "flex h-16 items-center justify-center" do %>
    <img src="/images/logo-compact.webp" class="w-[40px] h-[40px] lg:hidden" />
    <img src="/images/logo-full.webp" class="h-[40px] hidden lg:block" />
    <span class="sr-only"><%= Rails.configuration.application_name %></span>
  <% end %>

  <% if current_account.stack_manager.present? %>
    <div class="flex items-center justify-center">
      <%= render "devise/sessions/portainer_badge",
                 stack_manager: current_account.stack_manager,
                 logged_in: true %>
    </div>
  <% end %>
  <div class="flex items-center justify-center">
    <details class="mx-auto dropdown">
      <summary class="btn m-1"><%= current_account.name %> <iconify-icon icon="lucide:chevron-down"></iconify-icon></summary>
      <ul class="menu dropdown-content w-64 z-50 rounded-box bg-base-300 p-2 shadow">
        <!-- Current Account Section -->
        <li class="menu-title text-xs opacity-60 px-4 py-2">CURRENT ORGANIZATION</li>
        <li>
          <div class="flex items-center gap-3 px-4 py-3 cursor-default hover:bg-base-200">
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2">
                <span class="font-semibold truncate"><%= current_account.name %></span>
              </div>
            </div>
          </div>
        </li>

        <!-- Other Accounts Section -->
        <% other_accounts = current_user.accounts.where.not(id: current_account.id).order(created_at: :desc) %>
        <% if other_accounts.any? %>
          <li class="menu-title text-xs opacity-60 px-4 py-2 mt-2">OTHER ORGANIZATIONS</li>
          <% other_accounts.each do |account| %>
            <li>
              <%= link_to switch_account_path(account), class: "flex items-center gap-3 px-4 py-3" do %>
                <div class="flex-1 min-w-0">
                  <div class="font-semibold truncate"><%= account.name %></div>
                </div>
              <% end %>
            </li>
          <% end %>
        <% end %>

        <hr class="my-2 border-base-content/15" />
        <li>
          <button class="btn btn-ghost btn-sm justify-start" onclick="click_outside_modal_2.showModal()">
            <iconify-icon icon="lucide:plus" height="16"></iconify-icon>
            <span>New organization</span>
          </button>
        </li>
      </ul>
    </details>
  </div>

  <div data-simplebar="init" class="h-[calc(100vh-128px)] lg:h-[calc(100vh-294px)] simplebar-scrollable-y">
    <div class="simplebar-wrapper">
      <div class="simplebar-mask">
        <div class="simplebar-offset">
          <div class="simplebar-content-wrapper">
            <div class="simplebar-content">
              <%= render "layouts/sidebars/dynamic" %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <% if ENV['DISCORD_INVITE_URL'].present? %>
    <div class="mx-4 hidden rounded bg-base-200 px-3 py-4 lg:block">
      <p class="text-center text-base font-medium">Need Help?</p>
      <p class="mt-3 text-center text-sm">Join our Discord server!</p>
      <div class="mt-3 text-center">
        <%= link_to ENV['DISCORD_INVITE_URL'], class: "btn btn-primary btn-sm" do %>
          Join Discord <iconify-icon icon="ic:baseline-discord" height="16"></iconify-icon>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
<!-- Start: Click Outside Modal -->
<dialog aria-label="Modal" class="modal" id="click_outside_modal_2">
  <div class="modal-box">
    <form method="dialog">
      <button aria-label="Close modal" class="btn btn-circle btn-ghost btn-sm absolute right-2 top-2">
        <iconify-icon icon="lucide:x" height="16"></iconify-icon>
      </button>
    </form>
    <div class="mb-4 w-full text-xl font-bold">New Account</div>
    <div>
      <%= form_with(model: Account.new, url: accounts_path) do |form| %>
        <div class="form-control mt-1 w-full">
          <label class="label">
            <span class="label-text">Account Name</span>
          </label>
          <%= form.text_field :name, class: "input input-bordered w-full focus:outline-offset-0" %>
        </div>
        <div class="form-footer">
          <%= form.button "Submit", class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>
<!-- End: Click Outside Modal -->
